!function(window,angular){function Utils($location,$log){function isMobileValid(mobile){return/^1\d{10}$/.test(mobile)}function isBlank(obj){return!obj||/^\s*$/.test(obj)||0==Object.keys(obj).length}function isNumber(n){return!isNaN(n)}function toPercent(value){return Math.min(Math.round(1e4*value)/100,100)}function merge(obj1,obj2){for(var attrname in obj2)obj1[attrname]=obj2[attrname]}function shuffle(array){for(var i=array.length-1;i>=0;i--){var r=Math.floor(Math.random()*(i+1)),temp=array[r];array[r]=array[i],array[i]=temp}return array}return{isBlank:isBlank,isMobileValid:isMobileValid,isNumber:isNumber,toPercent:toPercent,merge:merge,shuffle:shuffle}}angular.module("module.services",[]).service("Utils",Utils)}(window,window.angular),function(window,angular){function configCompileProvider($compileProvider){$compileProvider.imgSrcSanitizationWhitelist(/^\s*(https|file|blob|cdvfile|http|chrome-extension|blob:chrome-extension):|data:image\//)}function configHttpProvider($httpProvider){$httpProvider.defaults.headers.common["Content-Type"]="application/json",$httpProvider.defaults.headers.post["Content-Type"]="application/json"}function configureLocationProvider($locationProvider){$locationProvider.html5Mode({enabled:!1,requireBase:!1})}function extendLog($provide){$provide.decorator("$log",function($delegate,$injector){var _log=$delegate.log;return $delegate.log=function(msg,forceLog){return _log(msg),this},$delegate})}function initApp($rootScope,$http){$rootScope.loadingPage=!0,$rootScope.clickPage=function(){$rootScope.$broadcast("page_clicked",{})}}angular.module("how2read",["module.services"]).config(configCompileProvider).config(configHttpProvider).config(configureLocationProvider).config(extendLog).run(initApp)}(window,window.angular),function(window,angular){function IssueCtrl($rootScope,$http,$log,$location,Utils){function activate(){vm.currentPage="kickoff";var path=document.location.pathname.split("/");vm.issueId=path[2],vm.questionIndex=-1,vm.issue={questions:[]},$http.get("/api/issues/"+vm.issueId+"/first_question").then(function(response){vm.nextQuestion=vm.shuffleQuestion(response.data)},function(response){vm.nextQuestion={}})}function challengeQuestions(question_name){vm.showNextQuestion(),vm.currentPage="question"}function showNextQuestion(){return Utils.isBlank(vm.nextQuestion)?void vm.onVoteFinished():(vm.questionIndex++,void(vm.question=vm.nextQuestion))}function nextQuestionText(){return Utils.isBlank(vm.question)||Utils.isBlank(vm.question.next)?"查看成绩":"下一题"}function getChoiceName(choice){return[choice.name_ipa,choice.name_alias,choice.name_cn].filter(function(e){return""!=e}).join(", ")}function vote(question,choice){if(Utils.isBlank(vm.voting)){if(question.is_voted)return void vm.playAudio(choice);vm.voting=choice,$http.post("/api/questions/"+question.name+"/"+choice.id+"/vote").then(function(response){var correctChoices=response.data.correct_choices;vm.voting={},question.is_voted=!0,question.is_correct=correctChoices.some(function(c){return c==choice.id}),choice.is_voted=!0,question.choices.forEach(function(choice){choice.is_correct=correctChoices.some(function(c){return c==choice.id})}),vm.nextQuestion=response.data.next,$log.log("next question: ").log(vm.nextQuestion)},function(response){500==response.status&&(vm.serverError=!0),vm.voting={}})}}function onVoteFinished(){$http.post("/api/issues/"+vm.issueId+"/vote_finish").then(function(response){vm.summary=response.data,$log.log(vm.summary),vm.summary.over_takes_rate=vm.getOverTakesRate(vm.summary),document.title="您答对了"+vm.summary.question_count+"个中的"+vm.summary.correct_count+"个，战胜了"+vm.summary.over_takes_rate+"%的好友-程序员最容易读错的单词",vm.showResultPage()},function(response){})}function getOverTakesRate(summary){return 0==summary.over_takes?0:0==summary.user_count?100:Math.min(summary.over_takes/summary.user_count*100,100).toFixed(2)}function showResultPage(){vm.currentPage="result"}function clickPage(){}function getSourceType(){var desc="";return desc=1==vm.question.source_type?"官网":2==vm.question.source_type?"维基百科":"标准发音"}function playAudio(choice){if(!Utils.isBlank(choice)&&!Utils.isBlank(choice.audio_url)){var audio=new Audio(choice.audio_url);audio.play()}}function shuffleQuestion(question){return question.choices=Utils.shuffle(question.choices),question}var vm=this;vm.showNextQuestion=showNextQuestion,vm.nextQuestionText=nextQuestionText,vm.shuffleQuestion=shuffleQuestion,vm.getChoiceName=getChoiceName,vm.vote=vote,vm.onVoteFinished=onVoteFinished,vm.challengeQuestions=challengeQuestions,vm.showResultPage=showResultPage,vm.clickPage=clickPage,vm.getOverTakesRate=getOverTakesRate,vm.getSourceType=getSourceType,vm.playAudio=playAudio,activate()}angular.module("how2read").controller("IssueCtrl",IssueCtrl)}(window,window.angular),function(window,angular){function QuestionAddCtrl($rootScope,$http,$log,Utils){function activate(){vm.duplicateQuestions=[],vm.sourceTypes=[{id:0,label:"其他"},{id:1,label:"官网(作者)"},{id:2,label:"维基百科"},{id:3,label:"英语标准读音"}],vm.initQuestionPage()}function initQuestionPage(){vm.nameIsEmpty=!0,vm.nameDuplicate=!1,vm.question={name:"",description:"",source_type:0,source_url:"",remark:"",correctChoiceChecked:!0,correctChoice:{name_ipa:"",name_alias:"",name_cn:"",audio_url:""},choices:[{t:Date.now(),name_ipa:"",name_alias:"",name_cn:""}]},vm.currentPage="add"}function addChoice(){vm.question.choices.push({t:Date.now(),name_ipa:"",name_alias:"",name_cn:""})}function removeChoice(choice){vm.question.choices=vm.question.choices.filter(function(c){return c.t!=choice.t})}function quickValidateName(){return vm.nameIsEmpty=Utils.isBlank(vm.question.name),vm.nameIsEmpty||(vm.nameDuplicate=vm.duplicateQuestions.some(function(question){return question.name.toLowerCase()==vm.question.name.toLowerCase()})),vm.nameIsEmpty||vm.nameDuplicate}function fullValidateName(){vm.quickValidateName()||$http.get("/api/questions/find_by_name/"+vm.question.name).then(function(response){Utils.isBlank(response.data)?vm.nameDuplicate=!1:(vm.duplicateQuestions.push(response.data),vm.nameDuplicate=!0)},function(response){})}function validateChoiceName(choice){return choice.nameHasError=Utils.isBlank(choice.name_ipa)&&Utils.isBlank(choice.name_alias)&&Utils.isBlank(choice.name_cn),choice.nameHasError}function validateAll(){return vm.quickValidateName(),vm.question.correctChoiceChecked&&vm.validateChoiceName(vm.question.correctChoice),vm.question.choices.forEach(function(c){vm.validateChoiceName(c)}),vm.canSubmit()}function canSubmit(){return vm.nameIsEmpty||vm.nameDuplicate?!1:vm.question.correctChoiceChecked&&vm.question.correctChoice.nameHasError?!1:!vm.question.choices.some(function(c){return c.nameHasError})}function submit(){vm.processing||vm.validateAll()&&(vm.processing=!0,$http.post("/api/questions",vm.question).then(function(response){vm.processing=!1,vm.currentPage="result"},function(response){vm.processing=!1}))}function addQuestion(){vm.initQuestionPage()}var vm=this;vm.initQuestionPage=initQuestionPage,vm.validateAll=validateAll,vm.quickValidateName=quickValidateName,vm.fullValidateName=fullValidateName,vm.validateChoiceName=validateChoiceName,vm.addChoice=addChoice,vm.removeChoice=removeChoice,vm.canSubmit=canSubmit,vm.submit=submit,vm.addQuestion=addQuestion,activate()}angular.module("how2read").controller("QuestionAddCtrl",QuestionAddCtrl)}(window,window.angular),function(window,angular){function QuestionCtrl($rootScope,$http,$log,$location,Utils){function activate(){}function playAudio(audio_url){if(!Utils.isBlank(audio_url)){var audio=new Audio(audio_url);audio.play()}}var vm=this;vm.playAudio=playAudio,activate()}angular.module("how2read").controller("QuestionCtrl",QuestionCtrl)}(window,window.angular);